<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Agglomerate taxa using phylogeny-derived distances. — tip_glom • speedyseq</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Agglomerate taxa using phylogeny-derived distances. — tip_glom" />
<meta property="og:description" content="All tips of the tree separated by a phylogenetic cophenetic distance smaller
than h will be agglomerated into one taxon." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">speedyseq</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/mikemc/speedyseq/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Agglomerate taxa using phylogeny-derived distances.</h1>
    <small class="dont-index">Source: <a href='https://github.com/mikemc/speedyseq/blob/master/R/agglomeration.R'><code>R/agglomeration.R</code></a></small>
    <div class="hidden name"><code>tip_glom.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>All tips of the tree separated by a phylogenetic cophenetic distance smaller
than <code>h</code> will be agglomerated into one taxon.</p>
    </div>

    <pre class="usage"><span class='fu'>tip_glom</span>(<span class='no'>physeq</span>, <span class='kw'>h</span> <span class='kw'>=</span> <span class='fl'>0.2</span>, <span class='kw'>hcfun</span> <span class='kw'>=</span> <span class='kw pkg'>cluster</span><span class='kw ns'>::</span><span class='no'><a href='https://rdrr.io/pkg/cluster/man/agnes.html'>agnes</a></span>, <span class='kw'>tax_adjust</span> <span class='kw'>=</span> <span class='fl'>1L</span>, <span class='no'>...</span>)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>physeq</th>
      <td><p>(Required). A <code>phyloseq-class()</code>, containing a phylogenetic
tree. Alternatively, a phylogenetic tree <code><a href='https://rdrr.io/pkg/ape/man/read.tree.html'>ape::phylo()</a></code> will also work.</p></td>
    </tr>
    <tr>
      <th>h</th>
      <td><p>(Optional). Numeric scalar of the height where the tree should be
cut. This refers to the tree resulting from hierarchical clustering of the
distance matrix, not the original phylogenetic tree. Default value is <code>0.2</code>.</p></td>
    </tr>
    <tr>
      <th>hcfun</th>
      <td><p>(Optional). A function. The (agglomerative, hierarchical)
clustering function to use. The default is <code><a href='https://rdrr.io/pkg/cluster/man/agnes.html'>cluster::agnes()</a></code> for phyloseq
compatiblity.</p></td>
    </tr>
    <tr>
      <th>tax_adjust</th>
      <td><p>0: no adjustment; 1: phyloseq-compatible adjustment; 2:
conservative adjustment (see <code><a href='merge_taxa_vec-methods.html'>merge_taxa_vec()</a></code> for details)</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>(Optional). Additional named arguments to pass to <code>hcfun</code>.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>An instance of the <code>phyloseq-class()</code>.  Or alternatively, a
<code>phylo()</code> object if the <code>physeq</code> argument was just a tree.  In the
expected-use case, the number of OTUs will be fewer (see <code>ntaxa()</code>), after
merging OTUs that are related enough to be called the same OTU.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>Can be used to create a non-trivial OTU Table, if a phylogenetic tree is
available.</p>
<p>By default, simple "greedy" single-linkage clustering is used. It is
possible to specify different clustering approaches by setting <code>hcfun</code> and
its parameters in <code>...</code>. In particular, complete-linkage clustering appears
to be used more commonly for OTU clustering applications.</p>
<p>The merged taxon is named according to the "archetype" defined as the the
most abundant taxon (having the largest value of <code>taxa_sums(physeq)</code>. The
tree and refseq objects are pruned to the archetype taxa.</p>
<p>Speedyseq note: <code><a href='https://rdrr.io/r/stats/hclust.html'>stats::hclust()</a></code> is faster than the default <code>hcfun</code>; set
<code>method = "average"</code> to get equivalent clustering.</p>
<p>Acknowledgements: Documentation and general strategy derived from
<code><a href='https://rdrr.io/pkg/phyloseq/man/tip_glom.html'>phyloseq::tip_glom()</a></code>.</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='https://rdrr.io/pkg/phyloseq/man/tip_glom.html'>phyloseq::tip_glom()</a></code></p>
<p><code><a href='tree_glom.html'>tree_glom()</a></code> for direct phylogenetic merging</p>
<p><code><a href='merge_taxa_vec-methods.html'>merge_taxa_vec()</a></code></p>
<p><code><a href='https://rdrr.io/pkg/cluster/man/agnes.html'>cluster::agnes()</a></code></p>
<p><code><a href='https://rdrr.io/r/stats/hclust.html'>stats::hclust()</a></code></p>
<p><code><a href='https://rdrr.io/pkg/castor/man/get_all_pairwise_distances.html'>castor::get_all_pairwise_distances()</a></code></p>
<p><code><a href='https://rdrr.io/pkg/ape/man/read.tree.html'>ape::phylo()</a></code></p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span>(<span class='st'>"esophagus"</span>)
<span class='no'>esophagus</span> <span class='kw'>&lt;-</span> <span class='fu'>prune_taxa</span>(<span class='fu'>taxa_names</span>(<span class='no'>esophagus</span>)[<span class='fl'>1</span>:<span class='fl'>25</span>], <span class='no'>esophagus</span>)
<span class='fu'><a href='plot_tree.html'>plot_tree</a></span>(<span class='no'>esophagus</span>, <span class='kw'>label.tips</span><span class='kw'>=</span><span class='st'>"taxa_names"</span>, <span class='kw'>size</span><span class='kw'>=</span><span class='st'>"abundance"</span>,
  <span class='kw'>title</span><span class='kw'>=</span><span class='st'>"Before tip_glom()"</span>)</div><div class='img'><img src='tip_glom-1.png' alt='' width='700' height='433' /></div><div class='input'><span class='fu'><a href='plot_tree.html'>plot_tree</a></span>(<span class='fu'>tip_glom</span>(<span class='no'>esophagus</span>, <span class='kw'>h</span><span class='kw'>=</span><span class='fl'>0.2</span>), <span class='kw'>label.tips</span><span class='kw'>=</span><span class='st'>"taxa_names"</span>,
  <span class='kw'>size</span><span class='kw'>=</span><span class='st'>"abundance"</span>, <span class='kw'>title</span><span class='kw'>=</span><span class='st'>"After tip_glom()"</span>)</div><div class='img'><img src='tip_glom-2.png' alt='' width='700' height='433' /></div><div class='input'>
<span class='co'># *speedyseq only:* Demonstration of different `tax_adjust` behaviors</span>
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span>(<span class='no'>GlobalPatterns</span>)

<span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span>(<span class='fl'>20190421</span>)
<span class='no'>ps</span> <span class='kw'>&lt;-</span> <span class='fu'>prune_taxa</span>(<span class='fu'><a href='https://rdrr.io/r/base/sample.html'>sample</a></span>(<span class='fu'>taxa_names</span>(<span class='no'>GlobalPatterns</span>), <span class='fl'>2e2</span>), <span class='no'>GlobalPatterns</span>)

<span class='no'>ps1</span> <span class='kw'>&lt;-</span> <span class='fu'>tip_glom</span>(<span class='no'>ps</span>, <span class='fl'>0.1</span>, <span class='kw'>tax_adjust</span> <span class='kw'>=</span> <span class='fl'>1</span>)
<span class='no'>ps2</span> <span class='kw'>&lt;-</span> <span class='fu'>tip_glom</span>(<span class='no'>ps</span>, <span class='fl'>0.1</span>, <span class='kw'>tax_adjust</span> <span class='kw'>=</span> <span class='fl'>2</span>)
<span class='fu'>tax_table</span>(<span class='no'>ps1</span>)[<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>108</span>, <span class='fl'>136</span>, <span class='fl'>45</span>),]</div><div class='output co'>#&gt; Taxonomy Table:     [3 taxa by 7 taxonomic ranks]:
#&gt;        Kingdom    Phylum           Class                 Order               
#&gt; 578831 "Bacteria" "Bacteroidetes"  "Sphingobacteria"     "Sphingobacteriales"
#&gt; 2801   "Bacteria" "Planctomycetes" "Planctomycea"        "Pirellulales"      
#&gt; 185581 "Bacteria" "Proteobacteria" "Gammaproteobacteria" "Oceanospirillales" 
#&gt;        Family Genus            Species                             
#&gt; 578831 NA     "Niabella"       NA                                  
#&gt; 2801   NA     "Rhodopirellula" NA                                  
#&gt; 185581 "OM60" NA               "marinegammaproteobacteriumHTCC2080"</div><div class='input'><span class='fu'>tax_table</span>(<span class='no'>ps2</span>)[<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>108</span>, <span class='fl'>136</span>, <span class='fl'>45</span>),]</div><div class='output co'>#&gt; Taxonomy Table:     [3 taxa by 7 taxonomic ranks]:
#&gt;        Kingdom    Phylum           Class                 Order               
#&gt; 578831 "Bacteria" "Bacteroidetes"  "Sphingobacteria"     "Sphingobacteriales"
#&gt; 2801   "Bacteria" "Planctomycetes" "Planctomycea"        "Pirellulales"      
#&gt; 185581 "Bacteria" "Proteobacteria" "Gammaproteobacteria" "Oceanospirillales" 
#&gt;        Family Genus Species
#&gt; 578831 NA     NA    NA     
#&gt; 2801   NA     NA    NA     
#&gt; 185581 "OM60" NA    NA     </div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Michael McLaren.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


